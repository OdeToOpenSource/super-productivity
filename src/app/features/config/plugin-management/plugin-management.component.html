@if (allPlugins().length === 0) {
  <mat-card>
    <mat-card-content class="empty-state">
      <mat-icon>extension_off</mat-icon>
      <p>{{ T.PS.NO_PLUGINS_INSTALLED | translate }}</p>
    </mat-card-content>
  </mat-card>
}

<mat-card>
  <mat-card-header>
    <mat-card-title>Install Plugin</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p>Upload a plugin ZIP file to install it:</p>
    <input
      #fileInput
      type="file"
      accept=".zip"
      (change)="onFileSelected($event)"
      style="display: none"
    />
    <button
      mat-raised-button
      color="primary"
      (click)="fileInput.click()"
      [disabled]="isUploading()"
    >
      <mat-icon>upload</mat-icon>
      {{ isUploading() ? 'Installing...' : 'Choose Plugin File' }}
    </button>
    @if (uploadError()) {
      <mat-error style="margin-top: 8px; display: block">
        {{ uploadError() }}
      </mat-error>
    }

    <div style="margin-top: 16px">
      <button
        mat-button
        color="warn"
        (click)="clearPluginCache()"
        [disabled]="isUploading()"
      >
        <mat-icon>delete_sweep</mat-icon>
        Clear Plugin Cache
      </button>
    </div>
  </mat-card-content>
</mat-card>
<mat-card>EMPTY</mat-card>

@for (plugin of allPlugins(); track plugin.manifest.id) {
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ plugin.manifest.name }}</mat-card-title>
      <mat-card-subtitle>
        v{{ plugin.manifest.version }}
        <!--        <mat-chip [color]="getPluginStatusColor(plugin)">-->
        <!--          {{ getPluginStatusText(plugin) }}-->
        <!--        </mat-chip>-->
      </mat-card-subtitle>
      <mat-slide-toggle
        [checked]="isPluginEnabledSync(plugin)"
        [disabled]="!!plugin.error"
        (change)="onPluginToggle(plugin, $event)"
        [attr.aria-label]="'Toggle ' + plugin.manifest.name"
      >
      </mat-slide-toggle>
    </mat-card-header>

    <mat-card-content>
      <p>{{ getPluginDescription(plugin) }}</p>

      @if (plugin.error) {
        <mat-error>
          <mat-icon>error</mat-icon>
          {{ plugin.error }}
        </mat-error>
      }

      <table>
        <tr>
          <th>ID:</th>
          <td>{{ plugin.manifest.id }}</td>
        </tr>
        @if (plugin.manifest.minSupVersion) {
          <tr>
            <th>Min. Version:</th>
            <td>{{ plugin.manifest.minSupVersion }}</td>
          </tr>
        }
        @if (plugin.manifest.hooks && plugin.manifest.hooks.length > 0) {
          <tr>
            <th>Hooks:</th>
            <td>
              <mat-chip-set>
                @for (hook of plugin.manifest.hooks; track hook) {
                  <mat-chip>{{ hook }}</mat-chip>
                }
              </mat-chip-set>
            </td>
          </tr>
        }
        @if (plugin.manifest.permissions && plugin.manifest.permissions.length > 0) {
          <tr>
            <th>Permissions:</th>
            <td>
              <mat-chip-set>
                @for (permission of plugin.manifest.permissions; track permission) {
                  <mat-chip>{{ permission }}</mat-chip>
                }
              </mat-chip-set>
            </td>
          </tr>
        }
      </table>
    </mat-card-content>

    <mat-card-actions [align]="'end'">
      <button
        mat-button
        color="primary"
        (click)="reloadPlugin(plugin)"
        [disabled]="!!plugin.error"
      >
        <mat-icon>refresh</mat-icon>
        {{ T.PS.RELOAD | translate }}
      </button>
      @if (isUploadedPlugin(plugin)) {
        <button
          mat-button
          color="warn"
          (click)="removeUploadedPlugin(plugin)"
          [disabled]="isUploading()"
        >
          <mat-icon>delete</mat-icon>
          Remove
        </button>
      }
    </mat-card-actions>
  </mat-card>
}

<div class="bottom-bar"></div>
