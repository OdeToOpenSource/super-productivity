<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>API Test Plugin Dashboard</title>
    <style>
      body {
        font-family: monospace;
        margin: 0;
        padding: 20px;
        background: transparent;
        color: #ccc;
      }

      h1 {
        font-size: 18px;
        margin: 0 0 20px 0;
      }

      h2 {
        font-size: 14px;
        margin: 0 0 10px 0;
      }

      h3 {
        font-size: 12px;
        margin: 0 0 8px 0;
      }

      .test-section {
        margin-bottom: 20px;
        border-left: 2px solid #666;
        padding-left: 10px;
      }

      .button-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      button {
        padding: 6px 12px;
        border: 1px solid #666;
        background: transparent;
        color: #ccc;
        font-size: 12px;
        font-family: monospace;
        cursor: pointer;
      }

      button:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: #999;
      }

      .run-all {
        display: block;
        width: 100%;
        margin-bottom: 20px;
        border-color: #4caf50;
        color: #4caf50;
      }

      .run-all:hover {
        background: rgba(76, 175, 80, 0.1);
      }

      .console {
        background: rgba(0, 0, 0, 0.3);
        color: #ccc;
        padding: 10px;
        font-size: 11px;
        max-height: 200px;
        overflow-y: auto;
        margin-top: 20px;
        border: 1px solid #333;
      }

      .console-entry {
        margin: 2px 0;
      }

      .console-entry.success {
        color: #4caf50;
      }

      .console-entry.error {
        color: #f44336;
      }

      .console-entry.info {
        color: #999;
      }

      .api-info {
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #333;
      }

      .api-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 8px;
      }

      .api-item {
        padding: 4px 8px;
        border: 1px solid #444;
        font-size: 11px;
        color: #999;
      }
    </style>
  </head>
  <body>
    <h1>API Test Plugin</h1>

    <div class="api-info">
      <h3>Available API Methods</h3>
      <div class="api-list">
        <div class="api-item">getTasks()</div>
        <div class="api-item">getArchivedTasks()</div>
        <div class="api-item">getCurrentContextTasks()</div>
        <div class="api-item">addTask(data)</div>
        <div class="api-item">updateTask(id, data)</div>
        <div class="api-item">getAllProjects()</div>
        <div class="api-item">addProject(data)</div>
        <div class="api-item">updateProject(id, data)</div>
        <div class="api-item">getAllTags()</div>
        <div class="api-item">addTag(data)</div>
        <div class="api-item">updateTag(id, data)</div>
        <div class="api-item">showSnack(config)</div>
        <div class="api-item">notify(config)</div>
        <div class="api-item">openDialog(config)</div>
        <div class="api-item">persistDataSynced(data)</div>
        <div class="api-item">loadSyncedData()</div>
        <div class="api-item">registerHook(hook, handler)</div>
        <div class="api-item">registerHeaderButton(config)</div>
        <div class="api-item">registerMenuEntry(config)</div>
        <div class="api-item">registerShortcut(config)</div>
      </div>
    </div>

    <button
      class="run-all"
      onclick="runAllTests()"
    >
      Run All API Tests
    </button>

    <div class="test-section">
      <h2>Data Persistence Tests</h2>
      <div class="button-grid">
        <button onclick="testPersistData()">Test Save Data</button>
        <button onclick="testLoadData()">Test Load Data</button>
      </div>
    </div>

    <div class="test-section">
      <h2>Task Operations</h2>
      <div class="button-grid">
        <button onclick="testGetTasks()">Get All Tasks</button>
        <button onclick="testGetArchivedTasks()">Get Archived Tasks</button>
        <button onclick="testGetContextTasks()">Get Context Tasks</button>
        <button onclick="testCreateTask()">Create Test Task</button>
        <button onclick="testUpdateTask()">Update Last Task</button>
      </div>
    </div>

    <div class="test-section">
      <h2>Project & Tag Operations</h2>
      <div class="button-grid">
        <button onclick="testGetProjects()">Get All Projects</button>
        <button onclick="testCreateProject()">Create Test Project</button>
        <button onclick="testGetTags()">Get All Tags</button>
        <button onclick="testCreateTag()">Create Test Tag</button>
      </div>
    </div>

    <div class="test-section">
      <h2>UI Operations</h2>
      <div class="button-grid">
        <button onclick="testSnackSuccess()">Success Snack</button>
        <button onclick="testSnackError()">Error Snack</button>
        <button onclick="testSnackCustom()">Custom Snack</button>
        <button onclick="testNotification()">Show Notification</button>
        <button onclick="testDialog()">Open Dialog</button>
      </div>
    </div>

    <div
      class="console"
      id="console"
    >
      <div class="console-entry info">Console output will appear here...</div>
    </div>

    <script>
      let lastTaskId = null;
      let lastProjectId = null;
      let lastTagId = null;

      // Console logging
      function log(message, type = 'info') {
        const console = document.getElementById('console');
        const entry = document.createElement('div');
        entry.className = `console-entry ${type}`;
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        console.appendChild(entry);
        console.scrollTop = console.scrollHeight;
      }

      // Clear console
      function clearConsole() {
        document.getElementById('console').innerHTML =
          '<div class="console-entry info">Console cleared. Starting new test run...</div>';
      }

      // Test functions
      async function testPersistData() {
        try {
          const testData = {
            timestamp: new Date().toISOString(),
            randomValue: Math.floor(Math.random() * 1000),
            message: 'Test data from iframe',
          };
          await PluginAPI.persistDataSynced(JSON.stringify(testData));
          log('Data saved successfully: ' + JSON.stringify(testData), 'success');
        } catch (error) {
          log('Failed to save data: ' + error.message, 'error');
        }
      }

      async function testLoadData() {
        try {
          const data = await PluginAPI.loadSyncedData();
          if (data) {
            const parsed = JSON.parse(data);
            log('Data loaded successfully: ' + JSON.stringify(parsed), 'success');
          } else {
            log('No saved data found', 'info');
          }
        } catch (error) {
          log('Failed to load data: ' + error.message, 'error');
        }
      }

      async function testGetTasks() {
        try {
          const tasks = await PluginAPI.getTasks();
          log(`Found ${tasks.length} tasks`, 'success');
          if (tasks.length > 0) {
            lastTaskId = tasks[0].id;
            log(`Sample task: "${tasks[0].title}"`, 'info');
          }
        } catch (error) {
          log('Failed to get tasks: ' + error.message, 'error');
        }
      }

      async function testGetArchivedTasks() {
        try {
          const tasks = await PluginAPI.getArchivedTasks();
          log(`Found ${tasks.length} archived tasks`, 'success');
        } catch (error) {
          log('Failed to get archived tasks: ' + error.message, 'error');
        }
      }

      async function testGetContextTasks() {
        try {
          const tasks = await PluginAPI.getCurrentContextTasks();
          log(`Found ${tasks.length} tasks in current context`, 'success');
        } catch (error) {
          log('Failed to get context tasks: ' + error.message, 'error');
        }
      }

      async function testCreateTask() {
        try {
          const taskData = {
            title: 'Test Task from iFrame - ' + new Date().toLocaleTimeString(),
            notes: 'Created from the API Test Plugin dashboard',
            timeEstimate: 1800000, // 30 minutes
          };
          lastTaskId = await PluginAPI.addTask(taskData);
          log(`Task created with ID: ${lastTaskId}`, 'success');
        } catch (error) {
          log('Failed to create task: ' + error.message, 'error');
        }
      }

      async function testUpdateTask() {
        if (!lastTaskId) {
          log('No task ID available. Create a task first!', 'error');
          return;
        }
        try {
          await PluginAPI.updateTask(lastTaskId, {
            notes: 'Updated from dashboard at ' + new Date().toLocaleTimeString(),
          });
          log(`Task ${lastTaskId} updated successfully`, 'success');
        } catch (error) {
          log('Failed to update task: ' + error.message, 'error');
        }
      }

      async function testGetProjects() {
        try {
          const projects = await PluginAPI.getAllProjects();
          log(`Found ${projects.length} projects`, 'success');
          if (projects.length > 0) {
            lastProjectId = projects[0].id;
            log(`Sample project: "${projects[0].title}"`, 'info');
          }
        } catch (error) {
          log('Failed to get projects: ' + error.message, 'error');
        }
      }

      async function testCreateProject() {
        try {
          const project = await PluginAPI.addProject({
            title: 'Test Project - ' + new Date().toLocaleDateString(),
            themeColor: '#' + Math.floor(Math.random() * 16777215).toString(16),
          });
          lastProjectId = project.id;
          log(`Project created: "${project.title}"`, 'success');
        } catch (error) {
          log('Failed to create project: ' + error.message, 'error');
        }
      }

      async function testGetTags() {
        try {
          const tags = await PluginAPI.getAllTags();
          log(`Found ${tags.length} tags`, 'success');
          if (tags.length > 0) {
            lastTagId = tags[0].id;
            log(`Sample tag: "${tags[0].title}"`, 'info');
          }
        } catch (error) {
          log('Failed to get tags: ' + error.message, 'error');
        }
      }

      async function testCreateTag() {
        try {
          const tag = await PluginAPI.addTag({
            title: 'Test Tag - ' + Date.now(),
            color: '#' + Math.floor(Math.random() * 16777215).toString(16),
          });
          lastTagId = tag.id;
          log(`Tag created: "${tag.title}"`, 'success');
        } catch (error) {
          log('Failed to create tag: ' + error.message, 'error');
        }
      }

      function testSnackSuccess() {
        PluginAPI.showSnack({
          msg: 'This is a success message',
          type: 'SUCCESS',
          ico: 'check_circle',
        });
        log('Success snack shown', 'success');
      }

      function testSnackError() {
        PluginAPI.showSnack({
          msg: 'This is an error message',
          type: 'ERROR',
          ico: 'error',
        });
        log('Error snack shown', 'success');
      }

      function testSnackCustom() {
        PluginAPI.showSnack({
          msg: 'This is a custom message',
          type: 'CUSTOM',
          ico: 'info',
        });
        log('Custom snack shown', 'success');
      }

      function testNotification() {
        PluginAPI.notify({
          title: 'API Test Notification',
          body: 'This notification was triggered from the plugin dashboard!',
        });
        log('Notification sent', 'success');
      }

      function testDialog() {
        PluginAPI.openDialog({
          title: 'Test Dialog from iFrame',
          htmlContent: `
                    <div style="padding: 20px; color: #ccc; font-family: monospace;">
                        <h3 style="margin: 0 0 10px 0; font-size: 14px;">Test Dialog</h3>
                        <p style="margin: 5px 0; font-size: 12px;">Dialog opened from plugin dashboard</p>
                        <p style="margin: 5px 0; font-size: 12px; color: #999;">${new Date().toLocaleString()}</p>
                    </div>
                `,
          buttons: [
            {
              label: 'Awesome',
              icon: 'thumb_up',
              color: 'primary',
              onClick: () => {
                log('Dialog button clicked', 'success');
              },
            },
          ],
        });
        log('Dialog opened', 'success');
      }

      async function runAllTests() {
        clearConsole();
        log('Starting comprehensive API test suite...', 'info');

        // Run all tests with delays
        await testPersistData();
        await new Promise((r) => setTimeout(r, 500));

        await testLoadData();
        await new Promise((r) => setTimeout(r, 500));

        await testGetTasks();
        await new Promise((r) => setTimeout(r, 500));

        await testGetArchivedTasks();
        await new Promise((r) => setTimeout(r, 500));

        await testGetContextTasks();
        await new Promise((r) => setTimeout(r, 500));

        await testCreateTask();
        await new Promise((r) => setTimeout(r, 500));

        if (lastTaskId) {
          await testUpdateTask();
          await new Promise((r) => setTimeout(r, 500));
        }

        await testGetProjects();
        await new Promise((r) => setTimeout(r, 500));

        await testCreateProject();
        await new Promise((r) => setTimeout(r, 500));

        await testGetTags();
        await new Promise((r) => setTimeout(r, 500));

        await testCreateTag();
        await new Promise((r) => setTimeout(r, 500));

        testSnackSuccess();
        await new Promise((r) => setTimeout(r, 1500));

        testSnackError();
        await new Promise((r) => setTimeout(r, 1500));

        testSnackCustom();
        await new Promise((r) => setTimeout(r, 1500));

        testNotification();
        await new Promise((r) => setTimeout(r, 1000));

        testDialog();

        log('All tests completed! Check console for detailed results.', 'success');
      }

      // Initial message
      log(
        'API Test Plugin Dashboard loaded. Click buttons to test individual APIs or run all tests.',
        'info',
      );
    </script>
  </body>
</html>
