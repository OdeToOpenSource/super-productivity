<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Side Panel Test Plugin</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        margin: 0;
        background: var(--background-color, #f5f5f5);
        color: var(--text-color, #333);
      }

      .container {
        max-width: 100%;
        margin: 0 auto;
      }

      h1 {
        color: var(--primary-color, #2196f3);
        margin-bottom: 20px;
      }

      .info-box {
        background: var(--card-background, white);
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      button {
        background: var(--primary-color, #2196f3);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }

      button:hover {
        opacity: 0.9;
      }

      #tasks-container {
        margin-top: 20px;
      }

      .task-item {
        background: var(--card-background, white);
        padding: 10px;
        margin: 5px 0;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      /* Dark theme support */
      @media (prefers-color-scheme: dark) {
        :root {
          --background-color: #1e1e1e;
          --text-color: #e0e0e0;
          --card-background: #2a2a2a;
          --primary-color: #64b5f6;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Side Panel Test Plugin</h1>

      <div class="info-box">
        <h2>Plugin Information</h2>
        <p>This plugin demonstrates the new side panel functionality.</p>
        <p>Theme: <span id="theme">Loading...</span></p>
        <p>Platform: <span id="platform">Loading...</span></p>
      </div>

      <div class="info-box">
        <h2>Actions</h2>
        <button onclick="loadTasks()">Load Current Tasks</button>
        <button onclick="showNotification()">Show Notification</button>
        <button onclick="createTask()">Create Test Task</button>
      </div>

      <div id="tasks-container"></div>
    </div>

    <script>
      // Wait for PluginAPI to be available
      window.addEventListener('DOMContentLoaded', () => {
        if (window.PluginAPI) {
          document.getElementById('theme').textContent = PluginAPI.cfg.theme;
          document.getElementById('platform').textContent = PluginAPI.cfg.platform;
        }
      });

      async function loadTasks() {
        try {
          const tasks = await PluginAPI.getCurrentContextTasks();
          const container = document.getElementById('tasks-container');

          if (tasks.length === 0) {
            container.innerHTML =
              '<div class="info-box">No tasks in current context</div>';
            return;
          }

          container.innerHTML = '<h3>Current Tasks:</h3>';
          tasks.forEach((task) => {
            const taskEl = document.createElement('div');
            taskEl.className = 'task-item';
            taskEl.innerHTML = `
            <strong>${task.title}</strong>
            ${task.notes ? '<br><small>' + task.notes + '</small>' : ''}
          `;
            container.appendChild(taskEl);
          });
        } catch (error) {
          console.error('Failed to load tasks:', error);
          PluginAPI.showSnack({
            msg: 'Failed to load tasks',
            type: 'ERROR',
          });
        }
      }

      async function showNotification() {
        await PluginAPI.notify({
          title: 'Side Panel Plugin',
          body: 'This notification was sent from the side panel!',
        });
      }

      async function createTask() {
        try {
          const taskId = await PluginAPI.addTask({
            title: 'Task from Side Panel Plugin',
            notes: 'This task was created from the side panel test plugin',
          });

          PluginAPI.showSnack({
            msg: 'Task created successfully!',
            type: 'SUCCESS',
          });

          // Reload tasks
          loadTasks();
        } catch (error) {
          console.error('Failed to create task:', error);
          PluginAPI.showSnack({
            msg: 'Failed to create task',
            type: 'ERROR',
          });
        }
      }
    </script>
  </body>
</html>
